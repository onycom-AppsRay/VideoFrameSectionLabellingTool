<!DOCTYPE html>
<html>

<head>
  <title>opencv4nodejs electron example</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="./app.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-pink.min.css">
  <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>

  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
    integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
</head>

<body>
  <header class="centered-text">
    <h3>Loding Section Labeling Tool</h3>
  </header>

  <main>
    <section>
      <div class="centered-container">
        <label class="margin-right">
          Pick a .png or .jpg file:
          </span>
          <input 
            type="file" 
            onchange="onDirectorySelect(event)" 
            webkitdirectory
            directory
            multiple
          />
      </div>
    </section>

    <section>
      <div class="container">
        <div class="row">

          <!-- file list -->
          <div class="col-2" id="file-explorer">
            
            <div class="file-list-title">
              선택한 디렉토리
            </div>

            <div class="overflow-auto" id="file-list">
            </div>

            <div class="completed-file-list-title">
              완료된 파일
            </div>

            <div class="overflow-auto" id="completed-file-list">
            </div>

          </div>
          
          <!-- video explorer -->
          <div class="col-8" id="video-explorer">
            
            <div id="main-frame-title">
              메인 프레임
              <p>현재 파일: <span id="file-name"></span></p>
            </div>
            
            <div id="main-frame">
              <p style="margin: 0px;">현재 인덱스</p>
              <span id="frame-number">0</span>
              <canvas id="main-frame-mask"></canvas>
            </div>

            <div id="sub-frame-title">
              프레임 흐름
            </div>

            <div id="sub-frame">
            </div >

            <div id="sub-frame-button">
              <div class="input-group">
                <div class="input-group-prepend">
                  <span class="input-group-text">Start / End</span>
                </div>
                <input type="text" aria-label="Start" class="form-control" id="start-frame-input">
                <input type="text" aria-label="End" class="form-control" id="end-frame-input">
                <div class="input-group-append">
                  <button type="button" class="btn btn-outline-success" id="sub-frame-success">Next</button>
                </div>
              </div>
            </div>

          </div>
          
          <!-- button collection -->
          <div class="col-2" id="button-collection">

            <!-- Frame index 'input' tag group -->
            <div class="button-collection-title">버튼 레이아웃</div>     

            <div class="input-frame-index-group" id="input-container">
              <div class="input-group">
                <input type="text" aria-label="Start Frame" class="form-control" id="start-frame-1">
                <input type="text" aria-label="End Frame" class="form-control" id="end-frame-1">
                <div class="input-group-append">
                  <button class="btn btn-outline-secondary" type="button">x</button>
                </div>
              </div>
            </div>
            
            <!-- Complete & Next Button -->
            <div class="complete-title">완료 버튼</div>

            <div class="complete-button">
              <button onclick="onSuccess()">완료</button>
            </div>

          </div>

        </div>
      </div>
    </section>
  </main>

  <script src="./components/image/image-helper.js"></script>
  <script src="./components/video/video-util.js"></script>
  <script src="./components/file/file.js"></script>
  <script>
    const path = require('path');
    const SAMPLE_VIDEO = 'sample.mp4';

    const videoCapture = new cv.VideoCapture(path.resolve(SAMPLE_VIDEO));
    let frame = videoCapture.read();

    let i = 0;

    while(!frame.empty) {
      frameList.push(frame);
      frame = frame.resizeToMax(200);

      // frame flow part
      const canvas = document.createElement('canvas');
      canvas.setAttribute('class', `frame`);
      canvas.setAttribute('id', i);
      canvas.setAttribute('onclick', 'onSelectedFrame(event)');

      renderImage(frame, canvas);
      renderImageOnText(canvas);
      
      const container = document.getElementById('sub-frame');
      container.appendChild(canvas);

      i++;
      frame = videoCapture.read();
    }

    renderImage(frameList[0], document.getElementById('main-frame-mask'));

    // View file name 
    document.getElementById('file-name').innerText = SAMPLE_VIDEO;
  </script>

  <!-- click event -->
  <script>
    document.getElementById('sub-frame-success').onclick = onSubFrameSuccess;
  </script>
</body>

</html>